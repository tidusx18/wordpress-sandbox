!function(t){t(function(){MPHB.BookingsCalendar=can.Control.extend({},{filtersForm:null,customPeriodWrapper:null,btnPeriodPrev:null,btnPeriodNext:null,periodEl:null,init:function(t,e){this.filtersForm=this.element.find("#mphb-bookings-calendar-filters"),this.customPeriodWrapper=this.filtersForm.find(".mphb-custom-period-wrapper"),this.btnPeriodPrev=this.filtersForm.find(".mphb-period-prev"),this.btnPeriodNext=this.filtersForm.find(".mphb-period-next"),this.periodEl=this.filtersForm.find("#mphb-bookings-calendar-filter-period"),this.searchDateFromEl=this.filtersForm.find(".mphb-search-date-from"),this.searchDateToEl=this.filtersForm.find(".mphb-search-date-to"),this.initDatepickers()},initDatepickers:function(){this.filtersForm.find(".mphb-datepick").datepick({dateFormat:MPHB.Plugin.myThis.data.settings.dateFormat,showSpeed:0,showOtherMonths:!0,monthsToShow:MPHB.Plugin.myThis.data.settings.numberOfMonthDatepicker,pickerClass:MPHB.Plugin.myThis.data.settings.datepickerClass})},"#mphb-bookings-calendar-filter-period change":function(e,i){"custom"===t(e).val()?(this.customPeriodWrapper.removeClass("mphb-hide"),this.btnPeriodNext.addClass("mphb-hide"),this.btnPeriodPrev.addClass("mphb-hide")):(this.customPeriodWrapper.addClass("mphb-hide"),this.btnPeriodNext.removeClass("mphb-hide"),this.btnPeriodPrev.removeClass("mphb-hide"))},"#mphb-booking-calendar-search-room-availability-status change":function(e,i){""===t(e).val()?(this.searchDateFromEl.addClass("mphb-hide"),this.searchDateToEl.addClass("mphb-hide")):(this.searchDateFromEl.removeClass("mphb-hide"),this.searchDateToEl.removeClass("mphb-hide"))}}),MPHB.format_price=function(e,i){i=i||{};var n=MPHB.Plugin.myThis.data.settings.currency;i=t.extend({trim_zeros:!1},n,i),e=MPHB.number_format(e,i.decimals,i.decimal_separator,i.thousand_separator);var a=i.price_format.replace("%s",e);if(i.trim_zeros){var r=new RegExp("\\"+i.decimal_separator+"0+$|(\\"+i.decimal_separator+"\\d*[1-9])0+$");a=a.replace(r,"$1")}return'<span class="mphb-price">'+a+"</span>"},MPHB.format_percentage=function(e,i){i=i||{};var n=MPHB.Plugin.myThis.data.settings.currency;return i=t.extend({},n,i),'<span class="mphb-percentage">'+(e=MPHB.number_format(e,i.decimals,i.decimal_separator,i.thousand_separator))+"%</span>"},MPHB.number_format=function(t,e,i,n){var a,r,s,l,o,d="";return e=e||0,i=i||".",n=n||",",t<0&&(d="-",t*=-1),a=parseInt(t=(+t||0).toFixed(e))+"",(r=a.length)>3?r%=3:r=0,o=r?a.substr(0,r)+n:"",s=a.substr(r).replace(/(\d{3})(?=\d)/g,"$1"+n),l=e?i+Math.abs(t-a).toFixed(e).replace(/-/,0).slice(2):"",d+o+s+l},MPHB.Plugin=can.Construct.extend({myThis:null},{data:null,init:function(e,i){MPHB.Plugin.myThis=this,this.data=MPHB._data,delete MPHB._data;var n=t(".mphb-ctrl:not([data-inited])");this.setControls(n)},getVersion:function(){return this.data.version},getPrefix:function(){return this.data.prefix},addPrefix:function(t,e){return e=void 0!==e?e:"-",this.getPrefix()+e+t},setControls:function(e){var i,n;t.each(e,function(){switch(n=t(this).attr("data-type")){case"text":break;case"number":i=new MPHB.NumberCtrl(t(this));break;case"total-price":i=new MPHB.TotalPriceCtrl(t(this));break;case"price-breakdown":i=new MPHB.PriceBreakdownCtrl(t(this));break;case"gallery":i=new MPHB.GalleryCtrl(t(this));break;case"datepicker":i=new MPHB.DatePickerCtrl(t(this));break;case"color-picker":i=new MPHB.ColorPickerCtrl(t(this));break;case"complex":i=new MPHB.ComplexCtrl(t(this));break;case"complex-vertical":i=new MPHB.ComplexVerticalCtrl(t(this));break;case"dynamic-select":i=new MPHB.DynamicSelectCtrl(t(this));break;case"multiple-checkbox":i=new MPHB.MultipleCheckboxCtrl(t(this));break;case"amount":i=new MPHB.AmountCtrl(t(this));break;case"rules-list":i=new MPHB.RulesListCtrl(t(this));break;case"variable-pricing":i=new MPHB.VariablePricingCtrl(t(this))}t(this).attr("data-inited",!0)})}}),MPHB.AttributesCustomOrder=can.Control.extend({},{ITEM_SELECTOR:"tbody tr:not(.inline-edit-row)",TERM_ID_SELECTOR:".check-column input",TERM_ID_CLASS:".check-column",COLUMN_HANDLE:'<td class="column-handle"></td>',COLUMN_HANDLE_CLASS:".column-handle",init:function(e,i){this._super(e,i),e.find("tr:not(.inline-edit-row)").append(this.COLUMN_HANDLE),e.find(this.COLUMN_HANDLE_CLASS).show(),t(document).ajaxComplete(this.onAjaxComplete.bind(this)),e.sortable({items:this.ITEM_SELECTOR,cursor:"move",handle:this.COLUMN_HANDLE_CLASS,axis:"y",opacity:.65,scrollSensitivity:40,update:this.onUpdate.bind(this)})},onAjaxComplete:function(e,i,n){i&&4===i.readyState&&200===i.status&&n.data&&(n.data.indexOf("_inline_edit")>=0||n.data.indexOf("add-tag")>=0)&&(this.addMissingSortHandles(),t(document.body).trigger("init_tooltips"))},onUpdate:function(e,i){var n=i.item.find(this.TERM_ID_SELECTOR).val(),a=i.item.next().find(this.TERM_ID_SELECTOR).val();i.item.find(this.TERM_ID_SELECTOR).hide(),i.item.find(this.TERM_ID_CLASS).append('<span class="mphb-preloader"></span>');var r=this;t.ajax({url:MPHB.Plugin.myThis.data.ajaxUrl,type:"POST",dataType:"json",data:{action:"mphb_attributes_custom_ordering",mphb_nonce:MPHB.Plugin.myThis.data.nonces.mphb_attributes_custom_ordering,term_id:n,next_term_id:a,taxonomy_name:MPHB.Plugin.myThis.data.settings.editTaxonomyName},complete:function(t,e){i.item.find(r.TERM_ID_CLASS).find(".mphb-preloader").remove(),i.item.find(r.TERM_ID_SELECTOR).show()}}),this.element.find("tbody tr").each(function(e,i){e%2==0?t(this).addClass("alternate"):t(this).removeClass("alternate")})},addMissingSortHandles:function(){var e=this.element.find("tbody > tr"),i=this.element.find("tbody > tr > td"+this.COLUMN_HANDLE_CLASS).parent();if(e.length!=i.length){var n=this;e.each(function(e,a){i.is(a)||t(a).append(n.COLUMN_HANDLE)}),this.element.find(this.COLUMN_HANDLE_CLASS).show()}}}),MPHB.WPGallery=can.Construct.extend({myThis:null,getInstance:function(){return null===MPHB.WPGallery.myThis&&(MPHB.WPGallery.myThis=new MPHB.WPGallery),MPHB.WPGallery.myThis}},{frame:null,ctrl:null,init:function(){MPHB.WPGallery.myThis=this,Attachment=wp.media.model.Attachment,wp.media.controller.MPHBGallery=wp.media.controller.FeaturedImage.extend({defaults:parent._.defaults({id:"mphb-media-library-gallery",title:MPHB.Plugin.myThis.data.translations.roomTypeGalleryTitle,toolbar:"main-insert",filterable:"uploaded",library:wp.media.query({type:"image"}),multiple:"add",editable:!0,priority:60,syncSelection:!1},wp.media.controller.Library.prototype.defaults),updateSelection:function(){var t,e=this.get("selection"),i=MPHB.WPGallery.myThis.ctrl.get();""!==i&&-1!==i&&(t=parent._.map(i.split(/,/),function(t){return Attachment.get(t)})),e.reset(t)}}),wp.media.view.MediaFrame.MPHBGallery=wp.media.view.MediaFrame.Post.extend({createStates:function(){this.options;this.states.add([new wp.media.controller.MPHBGallery])},bindHandlers:function(){wp.media.view.MediaFrame.Select.prototype.bindHandlers.apply(this,arguments),this.on("toolbar:create:main-insert",this.createToolbar,this);var t={content:{embed:"embedContent","edit-selection":"editSelectionContent"},toolbar:{"main-insert":"mainInsertToolbar"}};parent._.each(t,function(t,e){parent._.each(t,function(t,i){this.on(e+":render:"+i,this[t],this)},this)},this)},mainInsertToolbar:function(t){var e=this;this.selectionStatusToolbar(t),t.set("insert",{style:"primary",priority:80,text:MPHB.Plugin.myThis.data.translations.addGalleryToRoomType,requires:{selection:!0},click:function(){var t=e.state(),i=t.get("selection");e.close(),t.trigger("insert",i).reset()}})}}),this.frame=new wp.media.view.MediaFrame.MPHBGallery(parent._.defaults({},{state:"mphb-media-library-gallery",library:{type:"image"},multiple:!0})),this.frame.on("open",this.proxy("onOpen")),this.frame.on("insert",this.proxy("setImage"))},open:function(t){this.ctrl=t,this.frame.open()},onOpen:function(){var t=this.frame;t.reset();var e=this.ctrl.getArray();if(e.length){var i=null;e.forEach(function(e){i=wp.media.attachment(e),i.fetch(),t.state().get("selection").add(i)})}},setImage:function(){var e=[],i=this.frame.state().get("selection").models;t.each(i,function(t,i){var n=i.attributes;e.push(n.id)}),this.ctrl.set(e.join(","))}}),MPHB.Ctrl=can.Control.extend({renderValue:function(t){var e=t.attr("data-type");return t.find('input[type="'+e+'"]').val()}},{parentForm:null,init:function(t,e){this.parentForm=this.element.closest("form")}}),MPHB.AmountCtrl=MPHB.Ctrl.extend({renderValue:function(e){var i=e.find('input[type="number"]:not(:disabled)'),n=e.children(".mphb-amount-inputs").attr("data-render-type"),a="price"==n?MPHB.format_price:MPHB.format_percentage;if(1==i.length)return a(i.val());var r=MPHB.Plugin.myThis.data.translations.adults;return r+=a(t(i[0]).val()),r+="<br />"+MPHB.Plugin.myThis.data.translations.children,r+=a(t(i[1]).val())}},{mainWrapper:null,singleInputGroup:null,multipleInputsGroup:null,commonAmountInput:null,adultsAmountInput:null,childrenAmountInput:null,dependencyCtrl:null,singleInputTriggers:[],multipleInputsTriggers:[],init:function(e,i){this._super(e,i),this.mainWrapper=this.element.children(".mphb-amount-inputs"),this.singleInputGroup=this.mainWrapper.children(".mphb-amount-single-input-group"),this.multipleInputsGroup=this.mainWrapper.children(".mphb-amount-multiple-inputs-group"),this.commonAmountInput=this.singleInputGroup.find("input.mphb-amount-common-input"),this.adultsAmountInput=this.multipleInputsGroup.find("input.mphb-amount-adults-input"),this.childrenAmountInput=this.multipleInputsGroup.find("input.mphb-amount-children-input");var n=this.mainWrapper.attr("data-dependency");if(n){var a=this;this.dependencyCtrl=this.element.closest("form").find('[name="'+n+'"]'),this.dependencyCtrl.on("change",function(e){var i=t(this).val();a.onTrigger(i)})}this.singleInputTriggers=this.mainWrapper.attr("data-single-triggers").split(","),this.multipleInputsTriggers=this.mainWrapper.attr("data-multiple-triggers").split(",")},onTrigger:function(t){var e=-1!=this.singleInputTriggers.indexOf(t),i=-1!=this.multipleInputsTriggers.indexOf(t);-1!=t.indexOf("percent")?this.mainWrapper.attr("data-render-type","percentage"):this.mainWrapper.attr("data-render-type","price"),e?this.switchToSingleInput():i&&this.switchToMultipleInputs()},switchToSingleInput:function(){this.adultsAmountInput.prop("disabled",!0),this.childrenAmountInput.prop("disabled",!0),this.commonAmountInput.prop("disabled",!1),this.multipleInputsGroup.addClass("mphb-hide"),this.singleInputGroup.removeClass("mphb-hide")},switchToMultipleInputs:function(){this.commonAmountInput.prop("disabled",!0),this.adultsAmountInput.prop("disabled",!1),this.childrenAmountInput.prop("disabled",!1),this.singleInputGroup.addClass("mphb-hide"),this.multipleInputsGroup.removeClass("mphb-hide")}}),MPHB.ColorPickerCtrl=MPHB.Ctrl.extend({},{input:null,init:function(t,e){this._super(t,e),this.input=this.element.find("input"),this.input.spectrum({allowEmpty:!0,preferredFormat:"hex",showInput:!0,showInitial:!0,showAlpha:!1})}}),MPHB.ComplexCtrl=MPHB.Ctrl.extend({},{prototypeItem:null,itemsHolder:null,lastIndex:null,uniqid:null,itemSelector:"tr",metaName:null,init:function(t,e){this._super(t,e),this.uniqid=this.element.children("table").attr("data-uniqid"),this.metaName=this.element.children('input[type="hidden"]:first-of-type').attr("name"),this.initItemsHolder(),this.initAddBtn(),this.initDeleteBtns(),this.preparePrototypeItem(),this.initLastIndex(),this.setKeys(this.itemsHolder.children(this.itemSelector))},makeItemsHolderSortable:function(){this.itemsHolder.parent().hasClass("mphb-separate-sortable-table")?this.itemsHolder.sortable({handle:".mphb-sortable-handle",cursor:"move"}):this.itemsHolder.sortable()},initLastIndex:function(){this.lastIndex=0;var e=this;this.itemsHolder.children(this.itemSelector).each(function(i,n){e.lastIndex=Math.max(e.lastIndex,parseInt(t(n).attr("data-id")))})},initItemsHolder:function(){this.itemsHolder=this.element.children("table").children("tbody"),this.itemsHolder.hasClass("mphb-sortable")&&this.makeItemsHolderSortable()},initAddBtn:function(){var t=this;this.element.on("click",'.mphb-complex-add-item[data-id="'+this.uniqid+'"]',function(e){e.preventDefault(),t.addItem()})},initDeleteBtns:function(){var e=this;this.itemsHolder.on("click",'.mphb-complex-delete-item[data-id="'+this.uniqid+'"]',function(i){i.preventDefault(),e.deleteItem(t(this).closest(e.itemSelector))})},preparePrototypeItem:function(){var e=this.itemsHolder.children(".mphb-complex-item-prototype");this.prototypeItem=e.clone(),this.prototypeItem.removeClass("mphb-hide mphb-complex-item-prototype").find("[name]:not(.mphb-keep-disabled)").each(function(){t(this).removeAttr("disabled")}),e.remove()},getIncIndex:function(){return++this.lastIndex},setKeys:function(e){var i,n,a,r,s,l,o=this,d=new RegExp("%key_"+this.uniqid+"%","g"),h="%key_"+this.uniqid+"%";e.each(function(e,p){l=t(p),r=l.attr("data-id"),r===h&&(r=o.getIncIndex(),l.attr("data-id",r)),l.find('[name*="[%key_'+o.uniqid+'%]"]').each(function(){i=t(this).attr("name").replace(d,r),t(this).attr("name",i),t(this).attr("id")&&(n=t(this).attr("id").replace(d,r).replace(/\[|\]/g,"__"),t(this).attr("name",i).attr("id",n))}),l.find('[for*="[%key_'+o.uniqid+'%]"]').each(function(){a=t(this).attr("for").replace(d,r).replace(/\[|\]/g,"__"),t(this).attr("for",a)}),l.find('[data-dependency*="%key_'+o.uniqid+'%"]').each(function(){s=t(this).attr("data-dependency").replace(d,r),t(this).attr("data-dependency",s)})})},clonePrototypeItem:function(){var t=this.prototypeItem.clone();return this.setKeys(t),t},addItemToHolder:function(t){this.itemsHolder.append(t)},deleteItem:function(t){t.remove()},addItem:function(){var t=this.clonePrototypeItem();this.addItemToHolder(t);var e=t.find(".mphb-ctrl:not([data-inited])");MPHB.Plugin.myThis.setControls(e)}}),MPHB.ComplexVerticalCtrl=MPHB.ComplexCtrl.extend({},{itemSelector:"tbody",lastIndexInput:null,minItemsCount:0,init:function(t,e){this._super(t,e),this.minItemsCount=this.itemsHolder.attr("data-min-items-count")},initLastIndex:function(){this.lastIndexInput=this.itemsHolder.find(">tfoot .mphb-complex-last-index"),this.lastIndex=this.lastIndexInput.val()},getIncIndex:function(){var t=this._super();return this.lastIndexInput.val(t),t},initItemsHolder:function(){this.itemsHolder=this.element.children("table")},addItemToHolder:function(t){this.itemsHolder.children("tfoot").before(t)},disableDeleteButtons:function(){this.itemsHolder.children(this.itemSelector).children(".mphb-complex-item-actions-holder").find(".mphb-complex-delete-item").attr("disabled","disabled").addClass("mphb-hide")},enableDeleteButtons:function(){this.itemsHolder.children(this.itemSelector).children(".mphb-complex-item-actions-holder").find(".mphb-complex-delete-item").removeAttr("disabled").removeClass("mphb-hide")},updateItemActions:function(){this.itemsHolder.children(this.itemSelector).length<=this.minItemsCount?this.disableDeleteButtons():this.enableDeleteButtons()},updateDefaultItem:function(){var t=this.itemsHolder.children(this.itemSelector).find('>.mphb-complex-item-actions-holder [name="'+this.metaName+'[default]"]');t.filter(":checked").length||t.first().attr("checked","checked")},deleteItem:function(t){this._super(t),this.updateItemActions(),this.updateDefaultItem()},addItem:function(){this._super(),this.updateItemActions(),this.updateDefaultItem()}}),MPHB.DatePickerCtrl=MPHB.Ctrl.extend({renderValue:function(t){return t.find('input[type="text"]').val()}},{input:null,hiddenInput:null,init:function(e,i){if(this._super(e,i),this.input=this.element.find('input[type="text"]'),this.hiddenInput=this.element.find('input[type="hidden"]'),this.fixDate(),this.input.attr("readonly")||this.input.datepick({dateFormat:MPHB.Plugin.myThis.data.settings.dateFormat,altField:this.hiddenInput,altFormat:MPHB.Plugin.myThis.data.settings.dateTransferFormat,showSpeed:0,showOtherMonths:!1,monthsToShow:MPHB.Plugin.myThis.data.settings.numberOfMonthDatepicker,pickerClass:MPHB.Plugin.myThis.data.settings.datepickerClass}),!this.input.attr("required")){var n=this.hiddenInput;this.input.on("change",function(){""==t(this).val()&&n.val("")})}},fixDate:function(){if(this.hiddenInput.val()){var e=t.datepick.parseDate(MPHB.Plugin.myThis.data.settings.dateTransferFormat,this.hiddenInput.val()),i=t.datepick.formatDate(MPHB.Plugin.myThis.data.settings.dateFormat,e);this.input.val(i)}else;}}),MPHB.DynamicSelectCtrl=MPHB.Ctrl.extend({},{input:null,dependencyCtrl:null,ajaxAction:null,ajaxNonce:null,errorsWrapper:null,preloader:null,defaultValue:null,defaultOption:null,complexId:null,group:"",init:function(t,e){this._super(t,e),this.input=this.element.find("select"),this.defaultValue=this.input.attr("data-default"),this.defaultOption=this.input.find('option[value="'+this.defaultValue+'"]').clone(),this.errorsWrapper=this.element.find(".mphb-errors-wrapper"),this.preloader=this.element.find(".mphb-preloader"),this.ajaxAction=this.input.attr("data-ajax-action"),this.ajaxNonce=this.input.attr("data-ajax-nonce"),this.initDependencyCtrl(),this.initComplexId(),this.initGroup()},initDependencyCtrl:function(){var t=this.input.attr("data-dependency");this.dependencyCtrl=this.element.closest("form").find('[name="'+t+'"]');var e=this;this.dependencyCtrl.on("change",function(t){e.updateList()}).on("focus",function(t){e.hideErrors()})},initComplexId:function(){var t=this.element.parents("tr[data-id]");t.length>0&&(this.complexId=parseInt(t.attr("data-id")))},initGroup:function(){var t=this.element.parents(".mphb-ctrl-rules-list");t.length>0&&(this.group=t.attr("data-group"))},setOptions:function(e){var i=this;this.input.html(this.defaultOption.clone()),t.each(e,function(e,n){i.input.append(t("<option />",{value:e,html:n}))})},updateList:function(){var e=this;this.hideErrors(),this.showPreloader(),this.input.html(this.defaultOption.clone());var i={action:this.ajaxAction,mphb_nonce:this.ajaxNonce,formValues:this.parseFormToJSON()};t.ajax({url:MPHB.Plugin.myThis.data.ajaxUrl,type:"GET",dataType:"json",data:i,success:function(t){t.hasOwnProperty("success")?t.success?e.setOptions(t.data.options):e.showError(t.data.message):e.showError(MPHB.Plugin.myThis.data.translations.errorHasOccured)},error:function(t){e.showError(MPHB.Plugin.myThis.data.translations.errorHasOccured)},complete:function(t){e.hidePreloader()}})},parseFormToJSON:function(){var t=this.parentForm.serializeJSON();return""!=this.group&&(t=t[this.group]),null!=this.complexId&&(t=t[this.complexId]),t},showPreloader:function(){this.preloader.removeClass("mphb-hide")},hidePreloader:function(){this.preloader.addClass("mphb-hide")},hideErrors:function(){this.errorsWrapper.empty().addClass("mphb-hide")},showError:function(t){this.errorsWrapper.html(t).removeClass("mphb-hide")}}),MPHB.GalleryCtrl=MPHB.Ctrl.extend({},{input:null,previewHolder:null,addGalleryBtn:null,removeGalleryBtn:null,init:function(t,e){this._super(t,e),this.input=this.element.find("input[type=hidden]"),this.previewHolder=this.element.find("img").on("click",this.proxy("organizeGallery")),this.addGalleryBtn=this.element.find(".mphb-admin-organize-gallery-add").on("click",this.proxy("organizeGallery")),this.removeGalleryBtn=this.element.find(".mphb-admin-organize-gallery-remove").on("click",this.proxy("removeGallery"))},get:function(){return this.input.val()},getArray:function(){return""!==this.get()?this.get().split(/,/):[]},set:function(t){this.input.val(t),this.updatePreview(),this.updateBtnsVisibility()},updateBtnsVisibility:function(){""!==this.get()?(this.removeGalleryBtn.removeClass("mphb-hide"),this.addGalleryBtn.addClass("mphb-hide")):(this.removeGalleryBtn.addClass("mphb-hide"),this.addGalleryBtn.removeClass("mphb-hide"))},updatePreview:function(){var t=this.get();if(""!==t){var e=t.split(",").shift(),i=wp.media.attachment(e),n=i.attributes.sizes.medium.url;this.previewHolder.removeClass("mphb-hide").attr("src",n)}else this.previewHolder.addClass("mphb-hide").attr("src","")},organizeGallery:function(t){t.preventDefault(),MPHB.WPGallery.getInstance().open(this)},removeGallery:function(t){t.preventDefault(),this.set("")}}),MPHB.MultipleCheckboxCtrl=MPHB.Ctrl.extend({renderValue:function(e){var i=e.find('input[type="checkbox"]'),n=i.filter(".mphb-checkbox-all:checked"),a=i.filter(":checked");if(n.length>0||a.length==i.length)return MPHB.Plugin.myThis.data.translations.all;var r=[];return a.each(function(){var e=t(this).parent().text();r.push(e)}),r.length>0?r.join(", "):MPHB.Plugin.myThis.data.translations.none}},{checkboxes:null,selectAllCheckbox:null,init:function(t,e){this._super(t,e),this.checkboxes=this.element.find('input[type="checkbox"]:not(.mphb-checkbox-all)'),this.selectAllCheckbox=this.element.find('input[type="checkbox"].mphb-checkbox-all'),this.selectAllCheckbox.prop("checked")&&this.disableCheckboxes()},".mphb-checkbox-all click":function(){this.selectAllCheckbox.prop("checked")?(this.disableCheckboxes(),this.selectCheckboxes()):this.enableCheckboxes()},".mphb-checkbox-select-all click":function(t,e){e.preventDefault(),this.selectCheckboxes()},".mphb-checkbox-unselect-all click":function(t,e){e.preventDefault(),this.unselectAll(),this.enableCheckboxes()},disableCheckboxes:function(){this.checkboxes.prop("disabled",!0)},enableCheckboxes:function(){this.checkboxes.prop("disabled",!1)},selectCheckboxes:function(){this.checkboxes.prop("checked",!0)},unselectCheckboxes:function(){this.checkboxes.prop("checked",!1)},unselectAll:function(){this.selectAllCheckbox.prop("checked",!1),this.unselectCheckboxes()}}),MPHB.NumberCtrl=MPHB.Ctrl.extend({renderValue:function(t){var e=t.children('input[type="number"]');return e.val()+e.parent().text()}},{input:null,disableOn:[],init:function(e,i){this._super(e,i),this.input=this.element.children("[name]");var n=this.input.attr("data-dependency"),a=this.input.attr("data-disable-on");if(n&&a){this.disableOn=a.split(",");var r=this;this.element.closest("form").find('[name="'+n+'"]').on("change",function(e){var i=t(this).val();r.onDependencyChange(i)})}},onDependencyChange:function(t){-1!=this.disableOn.indexOf(t)?this.input.prop("disabled",!0):this.input.prop("disabled",!1)}}),MPHB.PriceBreakdownCtrl=MPHB.Ctrl.extend({},{".mphb-price-breakdown-expand click":function(e,i){i.preventDefault(),t(e).blur();var n=t(e).parents("tr.mphb-price-breakdown-group");n.find(".mphb-price-breakdown-rate").toggleClass("mphb-hide"),n.nextUntil("tr.mphb-price-breakdown-group").toggleClass("mphb-hide")}}),MPHB.RulesListCtrl=MPHB.Ctrl.extend({},{editClass:"mphb-rules-list-editing",editText:"",doneText:"",lastIndex:-1,rulesCount:0,table:null,tbody:null,rulePrototype:null,editingRule:null,noRulesMessage:null,prependNewItems:!1,init:function(e,i){this._super(e,i),this.editText=MPHB.Plugin.myThis.data.translations.edit,this.doneText=MPHB.Plugin.myThis.data.translations.done,this.noRulesMessage=e.find(".mphb-rules-list-empty-message"),this.table=e.children("table"),this.tbody=this.table.children("tbody"),this.tbody.hasClass("mphb-sortable")&&(this.tbody.sortable(),this.prependNewItems=!0);var n=this.tbody.children(".mphb-rules-list-prototype"),a=n.clone();n.remove(),a.removeClass("mphb-rules-list-prototype mphb-hide"),a.find(".mphb-ctrl:not(.mphb-keep-disabled) [name]:not(.mphb-keep-disabled)").each(function(){t(this).prop("disabled",!1)}),this.rulePrototype=a;var r=this.tbody.children("tr"),s=this.lastIndex;r.each(function(){var e=parseInt(t(this).attr("data-id"));s=Math.max(s,e)}),this.lastIndex=s,this.rulesCount=r.length},".mphb-rules-list-add-button click":function(){this.addRule()},".mphb-rules-list-edit-button click":function(t,e){var i=this.getRuleByButton(t);this.toggleEdit(i)},".mphb-rules-list-delete-button click":function(t,e){var i=this.getRuleByButton(t);this.deleteRule(i)},addRule:function(){var e=this.rulePrototype.clone(),i=this.nextIndex();e.attr("data-id",i),e.find('[name*="[$index$]"]').each(function(){var e=t(this),n=e.attr("name");n=n.replace("$index$",i),e.attr("name",n);var a=e.attr("id");a&&(a=a.replace("$index$",i),e.attr("id",a))}),e.find('[data-dependency*="[$index$]"]').each(function(){var e=t(this),n=e.attr("data-dependency");n=n.replace("$index$",i),e.attr("data-dependency",n)}),this.prependNewItems?this.tbody.prepend(e):this.tbody.append(e),this.increaseRulesCount();var n=e.find(".mphb-ctrl:not([data-inited])");MPHB.Plugin.myThis.setControls(n),this.toggleEdit(e)},toggleEdit:function(t){null!=this.editingRule&&(this.renderValues(this.editingRule),this.editingRule.removeClass(this.editClass),this.editingRule.find(".mphb-rules-list-edit-button").text(this.editText)),this.isEditingRule(t)?this.editingRule=null:(this.editingRule=t,t.addClass(this.editClass),t.find(".mphb-rules-list-edit-button").text(this.doneText))},deleteRule:function(t){this.isEditingRule(t)&&(this.editingRule=null),t.remove(),this.decreaseRulesCount()},isEditingRule:function(t){return null!=this.editingRule&&t[0]===this.editingRule[0]},getRuleByButton:function(t){return t.closest("tr")},increaseRulesCount:function(){0==this.rulesCount&&(this.noRulesMessage.addClass("mphb-hide"),this.table.removeClass("mphb-hide")),this.rulesCount++},decreaseRulesCount:function(){0==--this.rulesCount&&(this.table.addClass("mphb-hide"),this.noRulesMessage.removeClass("mphb-hide"))},nextIndex:function(){return++this.lastIndex},renderValues:function(e){var i=this;e.children("td").each(function(){var e=t(this),n=e.children(".mphb-ctrl");if(0!=n.length){var a=i.renderValue(n);e.children(".mphb-rules-list-rendered-value").html(a)}})},renderValue:function(t){var e=t.attr("data-type"),i="";switch(e){case"text":i=MPHB.Ctrl.renderValue(t);break;case"datepicker":i=MPHB.DatePickerCtrl.renderValue(t);break;case"textarea":i=t.find("textarea").val();break;case"number":i=MPHB.NumberCtrl.renderValue(t);break;case"select":case"dynamic-select":var n=t.children("select"),a=n.val();if(void 0!=a){i=n.children('option[value="'+a+'"]').text()}else i=MPHB.Plugin.myThis.data.translations.none;break;case"multiple-checkbox":i=MPHB.MultipleCheckboxCtrl.renderValue(t);break;case"amount":i=MPHB.AmountCtrl.renderValue(t);break;case"placeholder":i="-"}return i}}),MPHB.TotalPriceCtrl=MPHB.Ctrl.extend({},{preloader:null,input:null,init:function(t,e){this._super(t,e),this.input=this.element.find("input"),this.recalculateBtn=this.element.find("#mphb-recalculate-total-price"),this.errorsWrapper=this.element.find(".mphb-errors-wrapper"),this.preloader=this.element.find(".mphb-preloader")},set:function(t){this.input.val(t)},hideErrors:function(){this.errorsWrapper.empty().addClass("mphb-hide")},"input focus":function(){this.hideErrors()},showError:function(t){this.errorsWrapper.html(t).removeClass("mphb-hide")},"#mphb-recalculate-total-price click":function(e,i){var n=this;this.hideErrors(),this.showPreloader();var a=this.parseFormToJSON();t.ajax({url:MPHB.Plugin.myThis.data.ajaxUrl,type:"POST",dataType:"json",data:{action:"mphb_recalculate_total",mphb_nonce:MPHB.Plugin.myThis.data.nonces.mphb_recalculate_total,formValues:a},success:function(t){if(t.hasOwnProperty("success"))if(t.success){n.set(t.data.total);var e=n.element.closest("form").find('[name="_mphb_booking_price_breakdown"]'),i=e.siblings(".mphb-price-breakdown-wrapper");e.val(t.data.price_breakdown),e.prop("disabled",!1),i.html(t.data.price_breakdown_html)}else n.showError(t.data.message);else n.showError(MPHB.Plugin.myThis.data.translations.errorHasOccured)},error:function(t){n.showError(MPHB.Plugin.myThis.data.translations.errorHasOccured)},complete:function(t){n.hidePreloader()}})},showPreloader:function(){this.recalculateBtn.attr("disabled","disabled"),this.preloader.removeClass("mphb-hide")},hidePreloader:function(){this.recalculateBtn.removeAttr("disabled"),this.preloader.addClass("mphb-hide")},parseFormToJSON:function(){return this.parentForm.serializeJSON()}}),MPHB.VariablePricingCtrl=MPHB.Ctrl.extend({},{MIN_PERIOD:2,name:"",periodsTable:null,variationsTable:null,variationsTableBody:null,variationsTableFooter:null,afterPeriods:null,afterPrices:null,pricesHeaders:null,template:null,templateActions:null,lastIndex:-1,lastPeriodIndex:-1,periodsCount:0,removePeriodText:"",init:function(t,e){this._super(t,e),this.name=t.children(".mphb-pricing-name-holder").attr("name"),this.removePeriodText=MPHB.Plugin.myThis.data.translations.removePeriod,this.periodsTable=t.children(".mphb-pricing-periods-table"),this.variationsTable=t.children(".mphb-pricing-variations-table"),this.variationsTableBody=this.variationsTable.children("tbody"),this.variationsTableFooter=this.variationsTable.find("tfoot > tr > td"),this.afterPeriods=this.periodsTable.find("> tbody > tr:first-child > td:last-child"),this.afterPrices=this.periodsTable.find("> tbody > tr:last-child > td:last-child"),this.pricesHeaders=t.find(".mphb-pricing-price-per-night"),this.template=this.loadTemplate(),this.templateActions=this.template.children("td:last-child"),this.lastIndex=this.findLastIndex(),this.lastPeriodIndex=this.findLastPeriodIndex(),this.periodsCount=this.findPeriodsCount(),this.watchCheckbox()},loadTemplate:function(){var e=this.variationsTable.find(".mphb-pricing-variation-template"),i=e.clone();return e.remove(),i.removeClass("mphb-pricing-variation-prototype mphb-hide"),i.find("[name]").each(function(){t(this).prop("disabled",!1)}),i},addVariation:function(){var e=this.template.clone(),i=this.nextIndex();e.attr("data-index",i),e.find('[name*="[$index$]"]').each(function(){var e=t(this),n=e.attr("name");n=n.replace("$index$",i),e.attr("name",n)}),this.variationsTableBody.append(e)},removeVariation:function(t){t.remove()},addPeriod:function(){var e=this.nextPeriodIndex(),i='<input type="number" name="'+this.name+'[periods][]" class="small-text" value="'+this.MIN_PERIOD+'" min="'+this.MIN_PERIOD+'" step="1" />';i+='<br /><span class="dashicons dashicons-trash mphb-pricing-action mphb-pricing-remove-period" title="'+this.removePeriodText+'"></span>',i='<td data-period-index="'+e+'">'+i+"</td>";var n='<td data-period-index="'+e+'"><input type="text" name="'+this.name+'[prices][]" class="mphb-price-text" value="" /></td>',a='<td data-period-index="'+e+'"><input type="text" name="'+this.name+'[variations][$index$][prices][]" class="mphb-price-text" value="" /></td>';this.afterPeriods.before(i),this.afterPrices.before(n),this.templateActions.before(a),this.variationsTableBody.children("tr").each(function(e,i){var n=t(i),e=parseInt(n.attr("data-index"));n.children("td:last-child").before(a.replace("$index$",e))}),this.increasePeriodsCount()},removePeriod:function(t){this.template.find('[data-period-index="'+t+'"]').remove(),this.element.find('[data-period-index="'+t+'"]').remove(),this.decreasePeriodsCount()},nextIndex:function(){return++this.lastIndex},nextPeriodIndex:function(){return++this.lastPeriodIndex},findLastIndex:function(){var e=this.variationsTableBody.children("tr"),i=-1;return e.each(function(){var e=parseInt(t(this).attr("data-index"));i=Math.max(i,e)}),i},findLastPeriodIndex:function(){var e=this.periodsTable.find("> tbody > tr:first-child > td[data-period-index]"),i=-1;return e.each(function(){var e=parseInt(t(this).attr("data-period-index"));i=Math.max(i,e)}),i},findPeriodsCount:function(){return this.periodsTable.find("> tbody > tr:first-child > td[data-period-index]").length},increasePeriodsCount:function(){this.periodsCount++,this.updateColspans()},decreasePeriodsCount:function(){this.periodsCount--,this.updateColspans()},updateColspans:function(){this.pricesHeaders.attr("colspan",this.periodsCount),this.variationsTableFooter.attr("colspan",this.periodsCount+3)},watchCheckbox:function(){var t=this;this.element.find(".mphb-pricing-enable-variations").on("change",function(e){t.variationsTable.toggleClass("mphb-hide")})},".mphb-pricing-add-variation click":function(t,e){this.addVariation()},".mphb-pricing-remove-variation click":function(t,e){var i=t.closest("tr");this.removeVariation(i)},".mphb-pricing-add-period click":function(t,e){this.addPeriod()},".mphb-pricing-remove-period click":function(t,e){var i=t.closest("td"),n=i.attr("data-period-index")
;this.removePeriod(n)}}),new MPHB.Plugin,t(function(){t(".mphb-bookings-calendar-wrapper")&&new MPHB.BookingsCalendar(t(".mphb-bookings-calendar-wrapper")),MPHB.Plugin.myThis.data.settings.isAttributesCustomOrder&&new MPHB.AttributesCustomOrder(t("table.wp-list-table"))})})}(jQuery);